<!DOCTYPE html>
<html>
	<head>
		<title>
			Imagecropper 0.1
		</title>
		<!-- META -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <!-- STYLES -->
	    <link rel="stylesheet" href="../build/imagecrop.min.css">
	    <style type="text/css">
		    body {
				background-color: #c9c9c9;
			}
		</style>
	</head>
	<body>
		<!-- ENTER CONTENT -->
		<div class="test-imagecrop"></div>
		<button type="button" class="crop-button">
			<span>Crop!</span>
		</button>
		<button type="button" class="destroy-button">
			<span>Destroy</span>
		</button>
		<button type="button" class="create-button">
			<span>Create</span>
		</button>
		<div class="preview"></div>
		<!-- SCRIPTS -->
		<script type="text/javascript" src="../src/js/imagecrop.js"></script>
		<script type="text/javascript">
		window.onload = function() {
			var dimensions = null;
			var is_active = false;
			var img_c = null;

			var onUpdateHandler = function (dim) {
				dimensions = dim;
				console.log(dim);
			};

			var onCropHandler = function() {
				var img = new Image();
				img.src = img_c.crop('image/jpeg', 1);
				img.width = dimensions.w;
				img.height = dimensions.h;
				var target = document.querySelector('.preview');
				while(target.firstChild) {
					target.removeChild(target.firstChild)
				}
				target.appendChild(img);
			};

			var onCreateHandler = function() {
				if(is_active) { return; }

				new ImageCropper('.test-imagecrop', 'img.jpg', {
					update: onUpdateHandler
				});
				destroy_btn.style.display = 'initial';
				create_btn.style.display = 'none';

				is_active = true;
			};

			var onDestroyHandler = function() {
				if(!is_active) { return; }
				
				img_c.destroy();
				destroy_btn.style.display = 'none';
				create_btn.style.display = 'initial';

				is_active = false;
			};

			var crop_btn = document.querySelector('.crop-button');
			crop_btn.addEventListener('click', onCropHandler);

			var create_btn = document.querySelector('.create-button');
			create_btn.addEventListener('click', onCreateHandler);
			create_btn.style.display = 'none';

			var destroy_btn = document.querySelector('.destroy-button');
			destroy_btn.addEventListener('click', onDestroyHandler);

			img_c = new ImageCropper('.test-imagecrop', 'img.jpg', {
				update: onUpdateHandler,
				create_cb: function(dim) {
					console.log('created - ', dim);
				},
				destroy_cb: function() {
					console.log('destroy');
				}
			});
			is_active = true;
		}
		</script>
	</body>
</html>