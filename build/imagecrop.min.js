"use strict";var ImageCropper=function(){function e(e,t,i){t&&e&&(n=document.querySelector(e),n.className+=" imgc",i=i?i:{},w.update="update"in i?i.update:!1,w.max_width="max_width"in i?i.max_width:500,w.max_height="max_height"in i?i.max_height:500,l=new Image,l.addEventListener("load",function(e){this.create()}.bind(this)),l.src=t)}function t(e,t,n){var i=!1,n=n,h=e,o=t,d=function(e){e.stopPropagation(),i=!0,document.addEventListener("mouseup",u),document.addEventListener("mousemove",a)},a=function(e){e.stopPropagation(),i&&(n(p(e)),x(),g())},u=function(e){e.stopPropagation(),i=!1,document.removeEventListener("mouseup",u),document.removeEventListener("mousemove",a)};this.el=document.createElement("span"),this.el.className="imgc-handles-el-"+h+"-"+o,this.el.addEventListener("mousedown",d)}var n,i,h,o,d=function(e){return n.getBoundingClientRect()[e]},a=[],u=[function(e){c.w+=c.x-e.x,c.h+=c.y-e.y,c.x=e.x,c.y=e.y},function(e){c.w=e.x-c.x,c.h+=c.y-e.y,c.y=e.y},function(e){c.w=e.x-c.x,c.h=e.y-c.y},function(e){c.w+=c.x-e.x,c.x=e.x,c.h=e.y-c.y},function(e){c.h+=c.y-e.y,c.y=e.y},function(e){c.w=e.x-c.x},function(e){c.h=e.y-c.y},function(e){c.w+=c.x-e.x,c.x=e.x}],r=null,m=!1,s=!1,c={x:0,y:0,w:80,h:80},w={},l=null;e.prototype.create=function(){if(!m){var e=l.width,s=l.height;e>w.max_width&&(s=Math.floor(w.max_width*s/e),e=w.max_width),s>w.max_height&&(e=Math.floor(w.max_height*e/s),s=w.max_height),n.style.width=e+"px",n.style.height=s+"px",r=document.createElement("canvas"),r.setAttribute("width",2*e),r.setAttribute("height",2*s),n.appendChild(r);var c=r.getContext("2d");c.scale(2,2),n.appendChild(l),l.width=e,l.height=s,h=document.createElementNS("http://www.w3.org/2000/svg","svg"),h.setAttribute("height",d("height")),h.setAttribute("width",d("width")),n.appendChild(h),o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.style.fill="rgba(0, 0, 0, .8)",h.appendChild(o),i=document.createElement("div"),i.className="imgc-handles",n.appendChild(i),a=[];for(var p=0;8>p;p++)a.push(new t(Math.floor(p/4),p%4,u[p])),i.appendChild(a[p].el);n.addEventListener("mousedown",y),m=!0,g()}},e.prototype.destroy=function(){m&&(n.removeChild(r),n.removeChild(l),n.removeChild(h),n.removeChild(i),n.removeEventListener("mousedown",y),r=l=i=a=h=o=null,m=!1)},e.prototype.crop=function(e,t){(!e||"image/jpeg"!==e&&"image/png"!==e)&&(e="image/jpeg"),(!t||0>t||t>1)&&(t=1);var n=window.devicePixelRatio>1?2:1,i={x:c.x*n,y:c.y*n,w:c.w*n,h:c.h*n};r.setAttribute("width",i.w),r.setAttribute("height",i.h);var h=r.getContext("2d");return h.imageSmoothingEnabled=!1,h.drawImage(l,i.x,i.y,i.w,i.h,0,0,i.w,i.h),r.toDataURL(e,t)};var p=function(e){var t=e.clientX-d("left"),n=e.clientY-d("top");return{x:0>t?0:t>d("width")?d("width"):t,y:0>n?0:n>d("height")?d("height"):n}},x=function(){c.w=c.w<32?32:c.w,c.h=c.h<32?32:c.h,c.x=c.x<0?0:c.x+c.w>d("width")?d("width")-c.w:c.x,c.y=c.y<0?0:c.y+c.h>d("height")?d("height")-c.h:c.y},g=function(){i.style.top=c.y+"px",i.style.left=c.x+"px",i.style.width=c.w+"px",i.style.height=c.h+"px",o.setAttribute("d","M 0 0 v"+d("height")+"h"+d("width")+"v"+-d("height")+"H-0zM"+c.x+" "+c.y+"h"+c.w+"v"+c.h+"h-"+c.w+"V-"+c.h+"z"),w.update&&w.update(c)},v=function(e){e=p(e),c.x=e.x-.5*c.w,c.y=e.y-.5*c.h,x(),g()},y=function(e){s||(document.addEventListener("mousemove",E),document.addEventListener("mouseup",f),v(e),s=!0)},f=function(e){s&&(document.removeEventListener("mouseup",f),document.removeEventListener("mousemove",E),s=!1)},E=function(e){s&&v(e)};return e}();