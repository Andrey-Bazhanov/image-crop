"use strict";var ImageCropper=function(){function t(t,e,i){e&&t&&(n=document.querySelector(t),n.className+=" imgc",i=i?i:{},w.update="update"in i?i.update:!1,w.ratio="ratio"in i?i.ratio:1,w.max_width="max_width"in i?i.max_width:500,w.max_height="max_height"in i?i.max_height:500,l=new Image,l.addEventListener("load",function(t){this.create()}.bind(this)),l.src=e)}function e(t,e,n){var i=!1,n=n,o=t,h=e,d=function(t){t.stopPropagation(),i=!0,document.addEventListener("mouseup",r),document.addEventListener("mousemove",a)},a=function(t){t.stopPropagation(),i&&(n(x(t)),p(),g())},r=function(t){t.stopPropagation(),i=!1,document.removeEventListener("mouseup",r),document.removeEventListener("mousemove",a)};this.el=document.createElement("span"),this.el.className="imgc-handles-el-"+o+"-"+h,this.el.addEventListener("mousedown",d)}var n,i,o,h,d=function(t){return n.getBoundingClientRect()[t]},a=[],r=[function(t){c.w+=c.x-t.x,c.h+=c.y-t.y,c.x=t.x,c.y=t.y},function(t){c.w=t.x-c.x,c.h+=c.y-t.y,c.y=t.y},function(t){c.w=t.x-c.x,c.h=t.y-c.y},function(t){c.w+=c.x-t.x,c.x=t.x,c.h=t.y-c.y},function(t){c.h+=c.y-t.y,c.y=t.y},function(t){c.w=t.x-c.x},function(t){c.h=t.y-c.y},function(t){c.w+=c.x-t.x,c.x=t.x}],u=null,m=!1,s=!1,c={x:100,y:100,w:80,h:80},w={},l=null;t.prototype.create=function(){if(!m){var t=l.width,s=l.height;t>w.max_width&&(s=Math.floor(w.max_width*s/t),t=w.max_width),s>w.max_height&&(t=Math.floor(w.max_height*t/s),s=w.max_height),n.style.width=t+"px",n.style.height=s+"px",u=document.createElement("canvas"),u.setAttribute("width",2*t),u.setAttribute("height",2*s),n.appendChild(u);var c=u.getContext("2d");c.scale(2,2),n.appendChild(l),l.width=t,l.height=s,o=document.createElementNS("http://www.w3.org/2000/svg","svg"),o.setAttribute("height",d("height")),o.setAttribute("width",d("width")),n.appendChild(o),h=document.createElementNS("http://www.w3.org/2000/svg","path"),h.style.fill="rgba(0, 0, 0, .8)",o.appendChild(h),i=document.createElement("div"),i.className="imgc-handles",n.appendChild(i),a=[];for(var x=0;8>x;x++)a.push(new e(Math.floor(x/4),x%4,r[x])),i.appendChild(a[x].el);n.addEventListener("mousedown",y),m=!0,g()}},t.prototype.destroy=function(){m&&(n.removeChild(u),n.removeChild(l),n.removeChild(o),n.removeChild(i),n.removeEventListener("mousedown",y),u=l=i=a=o=h=null,m=!1)},t.prototype.crop=function(){console.log(c);var t=(window.devicePixelRatio>1?2:1,{x:2*c.x,y:2*c.y,w:2*c.w,h:2*c.h});u.setAttribute("width",t.w),u.setAttribute("height",t.h);var e=u.getContext("2d");return e.imageSmoothingEnabled=!1,e.drawImage(l,t.x,t.y,t.w,t.h,0,0,t.w,t.h),u.toDataURL("image/jpeg")};var x=function(t){var e=t.clientX-d("left"),n=t.clientY-d("top");return{x:0>e?0:e>d("width")?d("width"):e,y:0>n?0:n>d("height")?d("height"):n}},p=function(){c.w=c.w<32?32:c.w,c.h=c.h<32?32:c.h,c.x=c.x<0?0:c.x+c.w>d("width")?d("width")-c.w:c.x,c.y=c.y<0?0:c.y+c.h>d("height")?d("height")-c.h:c.y},g=function(){i.style.top=c.y+"px",i.style.left=c.x+"px",i.style.width=c.w+"px",i.style.height=c.h+"px",h.setAttribute("d","M 0 0 v"+d("height")+"h"+d("width")+"v"+-d("height")+"H-0zM"+c.x+" "+c.y+"h"+c.w+"v"+c.h+"h-"+c.w+"V-"+c.h+"z"),w.update&&w.update(c)},v=function(t){t=x(t),c.x=t.x-.5*c.w,c.y=t.y-.5*c.h,p(),g()},y=function(t){s||(document.addEventListener("mousemove",E),document.addEventListener("mouseup",f),v(t),s=!0)},f=function(t){s&&(document.removeEventListener("mouseup",f),document.removeEventListener("mousemove",E),s=!1)},E=function(t){s&&v(t)};return t}();