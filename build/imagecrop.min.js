var ImageCropper=function(){function t(t,e,n){e&&t&&(r=document.querySelector(t),r.className+=(" "+r.className+" ").indexOf(" imgc ")>-1?"":" imgc",n=n?n:{},v.update="update"in n?n.update:!1,v.max_width="max_width"in n?n.max_width:500,v.max_height="max_height"in n?n.max_height:500,E=new Image,E.addEventListener("load",function(t){this.create()}.bind(this)),E.src=e)}function e(t){var e=t.clientX-w("left"),n=t.clientY-w("top");return{x:0>e?0:e>w("width")?w("width"):e,y:0>n?0:n>w("height")?w("height"):n}}function n(){f.w=f.w<32?32:f.w,f.h=f.h<32?32:f.h,f.x=f.x<0?0:f.x+f.w>w("width")?w("width")-f.w:f.x,f.y=f.y<0?0:f.y+f.h>w("height")?w("height")-f.h:f.y}function i(){m.style.top=f.y+"px",m.style.left=f.x+"px",m.style.width=f.w+"px",m.style.height=f.h+"px",c.setAttribute("d","M 0 0 v"+w("height")+"h"+w("width")+"v"+-w("height")+"H-0zM"+f.x+" "+f.y+"h"+f.w+"v"+f.h+"h-"+f.w+"V-"+f.h+"z"),v.update&&v.update(f)}function h(t){t=e(t),f.x=t.x-.5*f.w,f.y=t.y-.5*f.h,n(),i()}function o(t){y||(document.addEventListener("mousemove",a),document.addEventListener("mouseup",d),h(t),y=!0)}function d(t){y&&(document.removeEventListener("mouseup",d),document.removeEventListener("mousemove",a),y=!1)}function a(t){y&&h(t)}function u(t,h,o){function d(t){t.stopPropagation(),r=!0,document.addEventListener("mouseup",u),document.addEventListener("mousemove",a)}function a(t){t.stopPropagation(),r&&(o(e(t)),n(),i())}function u(t){t.stopPropagation(),r=!1,document.removeEventListener("mouseup",u),document.removeEventListener("mousemove",a)}var r=!1,o=o,m=t,s=h;this.el=document.createElement("span"),this.el.className="imgc-handles-el-"+m+"-"+s,this.el.addEventListener("mousedown",d)}var r,m,s,c,w=function(t){return r.getBoundingClientRect()[t]},p=[],l=[function(t){f.w+=f.x-t.x,f.h+=f.y-t.y,f.x=t.x,f.y=t.y},function(t){f.w=t.x-f.x,f.h+=f.y-t.y,f.y=t.y},function(t){f.w=t.x-f.x,f.h=t.y-f.y},function(t){f.w+=f.x-t.x,f.x=t.x,f.h=t.y-f.y},function(t){f.h+=f.y-t.y,f.y=t.y},function(t){f.w=t.x-f.x},function(t){f.h=t.y-f.y},function(t){f.w+=f.x-t.x,f.x=t.x}],x=null,g=!1,y=!1,f={x:0,y:0,w:80,h:80},v={},E=null;return t.prototype.create=function(){if(!g){var t=E.width,e=E.height;t>v.max_width&&(e=Math.floor(v.max_width*e/t),t=v.max_width),e>v.max_height&&(t=Math.floor(v.max_height*t/e),e=v.max_height),r.style.width=t+"px",r.style.height=e+"px",x=document.createElement("canvas"),x.setAttribute("width",t),x.setAttribute("height",e),r.appendChild(x),r.appendChild(E),E.width=t,E.height=e,s=document.createElementNS("http://www.w3.org/2000/svg","svg"),s.setAttribute("height",w("height")),s.setAttribute("width",w("width")),r.appendChild(s),c=document.createElementNS("http://www.w3.org/2000/svg","path"),c.style.fill="rgba(0, 0, 0, .8)",s.appendChild(c),m=document.createElement("div"),m.className="imgc-handles",r.appendChild(m),p=[];for(var n=0;8>n;n++)p.push(new u(Math.floor(n/4),n%4,l[n])),m.appendChild(p[n].el);r.addEventListener("mousedown",o),g=!0,i()}},t.prototype.destroy=function(){if(g){for(;r.firstChild;)r.removeChild(r.firstChild);r.removeEventListener("mousedown",o),x=E=m=p=s=c=null,g=!1}},t.prototype.crop=function(t,e){(!t||"image/jpeg"!==t&&"image/png"!==t)&&(t="image/jpeg"),(!e||0>e||e>1)&&(e=1);var n={x:f.x,y:f.y,w:f.w,h:f.h};x.setAttribute("width",n.w),x.setAttribute("height",n.h);var i=x.getContext("2d");return i.imageSmoothingEnabled=!1,i.drawImage(E,n.x,n.y,n.w,n.h,0,0,n.w,n.h),x.toDataURL(t,e)},t}();