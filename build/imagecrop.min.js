var ImageCropper=function(){function e(e,t,n){t&&e&&(n=n?n:{},v.up="update"in n?n.update:!1,v.cn="cname"in n?n.cname:"imgc",v.cr="create_cb"in n?n.create_cb:!1,v.de="destroy_cb"in n?n.destroy_cb:!1,v.mw="max_width"in n?n.max_width:500,v.mh="max_height"in n?n.max_height:500,c=document.querySelector(e),c.className+=(" "+c.className+" ").indexOf(" "+v.cn+" ")>-1?"":" "+v.cn,E=new Image,E.addEventListener("load",function(e){this.create()}.bind(this)),E.src=t)}function t(e){var t=e.clientX-w("left"),n=e.clientY-w("top");return{x:0>t?0:t>w("width")?w("width"):t,y:0>n?0:n>w("height")?w("height"):n}}function n(){f.w=f.w<32?32:f.w,f.h=f.h<32?32:f.h,f.x=f.x<0?0:f.x+f.w>w("width")?w("width")-f.w:f.x,f.y=f.y<0?0:f.y+f.h>w("height")?w("height")-f.h:f.y}function i(){a.style.top=f.y+"px",a.style.left=f.x+"px",a.style.width=f.w+"px",a.style.height=f.h+"px",s.setAttribute("d","M 0 0 v"+w("height")+"h"+w("width")+"v"+-w("height")+"H-0zM"+f.x+" "+f.y+"h"+f.w+"v"+f.h+"h-"+f.w+"V-"+f.h+"z"),v.up&&v.up(f)}function o(e){e=t(e),f.x=e.x-.5*f.w,f.y=e.y-.5*f.h,n(),i()}function h(e){g||(document.addEventListener("mousemove",r),document.addEventListener("mouseup",d),o(e),g=!0)}function d(e){g&&(document.removeEventListener("mouseup",d),document.removeEventListener("mousemove",r),g=!1)}function r(e){g&&o(e)}function u(e,o,h){function d(e){e.stopPropagation(),c=!0,document.addEventListener("mouseup",u),document.addEventListener("mousemove",r)}function r(e){e.stopPropagation(),c&&(h(t(e)),n(),i())}function u(e){e.stopPropagation(),c=!1,document.removeEventListener("mouseup",u),document.removeEventListener("mousemove",r)}var c=!1,h=h,a=e,m=o;this.el=document.createElement("span"),this.el.className="imgc-handles-el-"+a+"-"+m,this.el.addEventListener("mousedown",d)}var c,a,m,s,w=function(e){return c.getBoundingClientRect()[e]},p=[],l=[function(e){f.w+=f.x-e.x,f.h+=f.y-e.y,f.x=e.x,f.y=e.y},function(e){f.w=e.x-f.x,f.h+=f.y-e.y,f.y=e.y},function(e){f.w=e.x-f.x,f.h=e.y-f.y},function(e){f.w+=f.x-e.x,f.x=e.x,f.h=e.y-f.y},function(e){f.h+=f.y-e.y,f.y=e.y},function(e){f.w=e.x-f.x},function(e){f.h=e.y-f.y},function(e){f.w+=f.x-e.x,f.x=e.x}],y=null,x=!1,g=!1,f={x:0,y:0,w:80,h:80},v={},E=null;return e.prototype.create=function(){if(!x){var e=E.width,t=E.height;e>v.mw&&(t=Math.floor(v.mw*t/e),e=v.mw),t>v.mh&&(e=Math.floor(v.mh*e/t),t=v.mh),c.style.width=e+"px",c.style.height=t+"px",y=document.createElement("canvas"),y.setAttribute("width",e),y.setAttribute("height",t),c.appendChild(y),c.appendChild(E),E.width=e,E.height=t,m=document.createElementNS("http://www.w3.org/2000/svg","svg"),m.setAttribute("height",w("height")),m.setAttribute("width",w("width")),c.appendChild(m),s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.style.fill="rgba(0, 0, 0, .8)",m.appendChild(s),a=document.createElement("div"),a.className="imgc-handles",c.appendChild(a),p=[];for(var n=0;8>n;n++)p.push(new u(Math.floor(n/4),n%4,l[n])),a.appendChild(p[n].el);c.addEventListener("mousedown",h),x=!0,i(),v.cr&&v.cr(f)}},e.prototype.destroy=function(){if(x){for(;c.firstChild;)c.removeChild(c.firstChild);c.removeEventListener("mousedown",h),y=E=a=p=m=s=null,x=!1,v.de&&v.de()}},e.prototype.crop=function(e,t){(!e||"image/jpeg"!==e&&"image/png"!==e)&&(e="image/jpeg"),(!t||0>t||t>1)&&(t=1);var n={x:f.x,y:f.y,w:f.w,h:f.h};y.setAttribute("width",n.w),y.setAttribute("height",n.h);var i=y.getContext("2d");return i.imageSmoothingEnabled=!1,i.drawImage(E,n.x,n.y,n.w,n.h,0,0,n.w,n.h),y.toDataURL(e,t)},e}();