var ImageCropper=function(){function t(t,e,i){e&&t&&(n=document.querySelector(t),n.className+=(" "+n.className+" ").indexOf(" imgc ")>-1?"":" imgc",i=i?i:{},w.update="update"in i?i.update:!1,w.max_width="max_width"in i?i.max_width:500,w.max_height="max_height"in i?i.max_height:500,p=new Image,p.addEventListener("load",function(t){this.create()}.bind(this)),p.src=e)}function e(t,e,n){var i=!1,n=n,h=t,o=e,a=function(t){t.stopPropagation(),i=!0,document.addEventListener("mouseup",u),document.addEventListener("mousemove",d)},d=function(t){t.stopPropagation(),i&&(n(l(t)),x(),g())},u=function(t){t.stopPropagation(),i=!1,document.removeEventListener("mouseup",u),document.removeEventListener("mousemove",d)};this.el=document.createElement("span"),this.el.className="imgc-handles-el-"+h+"-"+o,this.el.addEventListener("mousedown",a)}var n,i,h,o,a=function(t){return n.getBoundingClientRect()[t]},d=[],u=[function(t){c.w+=c.x-t.x,c.h+=c.y-t.y,c.x=t.x,c.y=t.y},function(t){c.w=t.x-c.x,c.h+=c.y-t.y,c.y=t.y},function(t){c.w=t.x-c.x,c.h=t.y-c.y},function(t){c.w+=c.x-t.x,c.x=t.x,c.h=t.y-c.y},function(t){c.h+=c.y-t.y,c.y=t.y},function(t){c.w=t.x-c.x},function(t){c.h=t.y-c.y},function(t){c.w+=c.x-t.x,c.x=t.x}],r=null,m=!1,s=!1,c={x:0,y:0,w:80,h:80},w={},p=null;t.prototype.create=function(){if(!m){var t=p.width,s=p.height;t>w.max_width&&(s=Math.floor(w.max_width*s/t),t=w.max_width),s>w.max_height&&(t=Math.floor(w.max_height*t/s),s=w.max_height),n.style.width=t+"px",n.style.height=s+"px",r=document.createElement("canvas"),r.setAttribute("width",t),r.setAttribute("height",s),n.appendChild(r),n.appendChild(p),p.width=t,p.height=s,h=document.createElementNS("http://www.w3.org/2000/svg","svg"),h.setAttribute("height",a("height")),h.setAttribute("width",a("width")),n.appendChild(h),o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.style.fill="rgba(0, 0, 0, .8)",h.appendChild(o),i=document.createElement("div"),i.className="imgc-handles",n.appendChild(i),d=[];for(var c=0;8>c;c++)d.push(new e(Math.floor(c/4),c%4,u[c])),i.appendChild(d[c].el);n.addEventListener("mousedown",f),m=!0,g()}},t.prototype.destroy=function(){if(m){for(;n.firstChild;)n.removeChild(n.firstChild);n.removeEventListener("mousedown",f),r=p=i=d=h=o=null,m=!1}},t.prototype.crop=function(t,e){(!t||"image/jpeg"!==t&&"image/png"!==t)&&(t="image/jpeg"),(!e||0>e||e>1)&&(e=1);var n={x:c.x,y:c.y,w:c.w,h:c.h};r.setAttribute("width",n.w),r.setAttribute("height",n.h);var i=r.getContext("2d");return i.imageSmoothingEnabled=!1,i.drawImage(p,n.x,n.y,n.w,n.h,0,0,n.w,n.h),r.toDataURL(t,e)};var l=function(t){var e=t.clientX-a("left"),n=t.clientY-a("top");return{x:0>e?0:e>a("width")?a("width"):e,y:0>n?0:n>a("height")?a("height"):n}},x=function(){c.w=c.w<32?32:c.w,c.h=c.h<32?32:c.h,c.x=c.x<0?0:c.x+c.w>a("width")?a("width")-c.w:c.x,c.y=c.y<0?0:c.y+c.h>a("height")?a("height")-c.h:c.y},g=function(){i.style.top=c.y+"px",i.style.left=c.x+"px",i.style.width=c.w+"px",i.style.height=c.h+"px",o.setAttribute("d","M 0 0 v"+a("height")+"h"+a("width")+"v"+-a("height")+"H-0zM"+c.x+" "+c.y+"h"+c.w+"v"+c.h+"h-"+c.w+"V-"+c.h+"z"),w.update&&w.update(c)},y=function(t){t=l(t),c.x=t.x-.5*c.w,c.y=t.y-.5*c.h,x(),g()},f=function(t){s||(document.addEventListener("mousemove",E),document.addEventListener("mouseup",v),y(t),s=!0)},v=function(t){s&&(document.removeEventListener("mouseup",v),document.removeEventListener("mousemove",E),s=!1)},E=function(t){s&&y(t)};return t}();